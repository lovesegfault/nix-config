# This file was autogenerated by actions.nix. Do not edit it manually.
# To make changes, edit the workflow definition in your flake's actions-nix configuration
# (typically under flake.actions-nix.workflows.".github/workflows/regenerate-workflows.yaml") and run:
#   nix run .#render-workflows
# Or commit to trigger the pre-commit hook if enabled.
jobs:
  regenerate:
    if: github.actor == 'renovate[bot]' || github.event_name == 'workflow_dispatch'
    runs-on: ubuntu-24.04
    steps:
    - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8
      with:
        fetch-depth: 2
        ref: ${{ github.head_ref || github.ref_name }}
        token: ${{ secrets.PAT }}
    - uses: DeterminateSystems/nix-installer-action@c5a866b6ab867e88becbed4467b93592bce69f8a
      with:
        extra-conf: |-
          accept-flake-config = true
          always-allow-substitutes = true
          builders-use-substitutes = true
          max-jobs = auto
    - uses: actions/cache@a7833574556fa59680c1b7cb190c1735db73ebf0
      with:
        key: nix-eval-${{ runner.os }}-${{ runner.arch }}-${{ hashFiles('flake.lock')
          }}
        path: ~/.cache/nix
        restore-keys: nix-eval-${{ runner.os }}-${{ runner.arch }}-
    - uses: cachix/cachix-action@0fc020193b5a1fa3ac4575aa3a7d3aa6a35435ad
      with:
        authToken: ${{ secrets.CACHIX_AUTH_TOKEN }}
        extraPullNames: nix-community
        name: nix-config
    - name: Regenerate workflows
      run: nix run .#render-workflows
    - name: Amend commit with regenerated workflows
      run: |-
        git config user.name "hatesegfault"
        git config user.email "bernardo+hatesegfault@meurer.org"
        git add .github/workflows/
        git diff --staged --quiet || git commit --amend --no-edit
        git push --force-with-lease
    - uses: peter-evans/enable-pull-request-automerge@a660677d5469627102a1c1e11409dd063606628d
      with:
        merge-method: rebase
        pull-request-number: ${{ github.event.pull_request.number }}
        token: ${{ secrets.PAT }}
    timeout-minutes: 60
name: regenerate-workflows
'on':
  pull_request:
    paths:
    - modules/flake-parts/actions.nix
    - flake.lock
  workflow_dispatch: {}
permissions:
  contents: write
  pull-requests: write
